

一、下载地址
nginx:下载地址：
https://github.com/nginx/nginx

nginx-upload-module:下载地址：
https://github.com/hongzhidao/nginx-upload-module

二、编译方法：

tar xf nginx-1.24.0.tar.gz
cd nginx-1.24.0
./auto/configure --prefix=/usr/local/nginx \
            --add-module=../nginx-upload-module
make && make install


三、配置方法nginx.conf
http {
    # 上传大小限制
    client_max_body_size 100m;

    server {
        listen 80;
        server_name upload.example.com;

        # 上传入口
        location /upload {
            # 1. 文件先落地
            upload_pass          @after_upload;     # 接收完后跳转
            upload_store         /tmp/nginx_upload 1;
            upload_store_access  user:rw group:rw all:rw;

            # 2. 把文件信息重新注入表单
            upload_set_form_field file[name] "$upload_file_name";
            upload_set_form_field file[path] "$upload_tmp_path";
            upload_set_form_field file[type] "$upload_content_type";
            upload_aggregate_form_field file[size] "$upload_file_size";
            upload_aggregate_form_field file[md5]  "$upload_file_md5";

            # 3. 原表单其它字段也透传
            upload_pass_form_field "^.*$";

            # 4. 出错自动清理
            upload_cleanup 400 404 499 500-505;
        }

        # 真正干活的后端（这里以 PHP-FPM 为例）
        location @after_upload {
            proxy_pass http://127.0.0.1:9000;   # 或 fastcgi_pass
        }

        # 可选：下载/浏览已传文件
        location /files {
            alias /var/www/files/;
            autoindex on;
        }
    }
}

